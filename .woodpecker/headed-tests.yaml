when:
  - event: push
    branch: main

steps:
  - name: headed
    image: zacharyspector/elide:latest
    pull: true
    commands:
      - TMPDIR=$(python find_ramdisk.py)
      - echo "TMPDIR=$TMPDIR"
      - export TMPDIR
      - DISPLAY=:0
      - echo "DISPLAY=$DISPLAY"
      - export DISPLAY
      - Xvfb $DISPLAY &
      - PYTHON=/usr/local/bin/python${PYTHON_VERSION}
      - echo "PYTHON=$PYTHON"
      - $PYTHON -m pip wheel kivy
      - tox run-parallel -c elide/tox.ini